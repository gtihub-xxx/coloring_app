<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé® „Å¨„Çä„Åà„Çπ„Çø„Ç∏„Ç™</title>

  <!-- React and ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide React Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Lucide React Icons as components
    const Upload = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Upload: lucide.Upload }, nameAttr: 'data-lucide', attrs: { ...props } });
        }
      }, []);
      return <i ref={ref} data-lucide="upload" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Palette = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Palette: lucide.Palette }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="palette" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Eraser = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Eraser: lucide.Eraser }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="eraser" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const RotateCcw = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { RotateCcw: lucide.RotateCcw }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="rotate-ccw" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Download = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Download: lucide.Download }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="download" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Plus = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Plus: lucide.Plus }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="plus" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Minus = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Minus: lucide.Minus }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="minus" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const PaintBucket = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { PaintBucket: lucide.PaintBucket }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="paint-bucket" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Undo2 = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Undo2: lucide.Undo2 }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="undo-2" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    const Redo2 = ({ size = 24, ...props }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({ icons: { Redo2: lucide.Redo2 }, nameAttr: 'data-lucide' });
        }
      }, []);
      return <i ref={ref} data-lucide="redo-2" style={{ width: size, height: size, display: 'inline-block', verticalAlign: 'middle' }}></i>;
    };

    function ColoringApp() {
      const imageCanvasRef = useRef(null);
      const drawCanvasRef = useRef(null);
      const lineCanvasRef = useRef(null);
      const [isDrawing, setIsDrawing] = useState(false);
      const [currentColor, setCurrentColor] = useState('#FF6B9D');
      const [brushSize, setBrushSize] = useState(10);
      const [tool, setTool] = useState('brush');
      const [uploadedImage, setUploadedImage] = useState(null);
      const [canvasSize, setCanvasSize] = useState({ width: 800, height: 600 });
      const [brightnessThreshold, setBrightnessThreshold] = useState(180);
      const [history, setHistory] = useState([]);
      const [historyIndex, setHistoryIndex] = useState(-1);
      const maxHistory = 20;

      const colors = [
        '#FF6B9D', '#C44569', '#F8B500', '#FFA07A',
        '#98D8C8', '#6BCB77', '#4D96FF', '#8B5CF6',
        '#E84393', '#FDCB6E', '#00B894', '#0984E3',
        '#2D3436', '#FFFFFF', '#95A5A6', '#34495E'
      ];

      useEffect(() => {
        const imageCanvas = imageCanvasRef.current;
        const drawCanvas = drawCanvasRef.current;
        const lineCanvas = lineCanvasRef.current;

        if (imageCanvas && drawCanvas && lineCanvas) {
          const ctx = drawCanvas.getContext('2d');
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';

          if (!uploadedImage) {
            imageCanvas.width = canvasSize.width;
            imageCanvas.height = canvasSize.height;
            drawCanvas.width = canvasSize.width;
            drawCanvas.height = canvasSize.height;
            lineCanvas.width = canvasSize.width;
            lineCanvas.height = canvasSize.height;

            const imgCtx = imageCanvas.getContext('2d');
            imgCtx.fillStyle = '#f8f9fa';
            imgCtx.fillRect(0, 0, canvasSize.width, canvasSize.height);
          }
        }

        const handleKeyDown = (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
            e.preventDefault();
            undo();
          }
          if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.shiftKey && e.key === 'z'))) {
            e.preventDefault();
            redo();
          }
        };

        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [uploadedImage, canvasSize, historyIndex, history]);

      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (!file) {
          console.log('„Éï„Ç°„Ç§„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
          return;
        }

        if (!file.type.startsWith('image/')) {
          alert('ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
          return;
        }

        console.log('„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÈñãÂßã:', file.name);

        const reader = new FileReader();

        reader.onerror = () => {
          console.error('„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº');
          alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
        };

        reader.onload = (event) => {
          console.log('„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
          const img = new Image();

          img.onerror = () => {
            console.error('ÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº');
            alert('ÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
          };

          img.onload = () => {
            console.log('ÁîªÂÉèË™≠„ÅøËæº„ÅøÊàêÂäü:', img.width, 'x', img.height);

            try {
              const imageCanvas = imageCanvasRef.current;
              const drawCanvas = drawCanvasRef.current;
              const lineCanvas = lineCanvasRef.current;

              if (!imageCanvas || !drawCanvas || !lineCanvas) {
                console.error('„Ç≠„É£„É≥„Éê„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
              }

              const maxWidth = 800;
              const maxHeight = 600;
              let width = img.width;
              let height = img.height;

              if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
              }
              if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
              }

              console.log('„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫Ë®≠ÂÆö:', width, 'x', height);

              imageCanvas.width = width;
              imageCanvas.height = height;
              drawCanvas.width = width;
              drawCanvas.height = height;
              lineCanvas.width = width;
              lineCanvas.height = height;

              setCanvasSize({ width, height });

              const imgCtx = imageCanvas.getContext('2d');
              imgCtx.fillStyle = '#ffffff';
              imgCtx.fillRect(0, 0, width, height);
              imgCtx.drawImage(img, 0, 0, width, height);

              const drawCtx = drawCanvas.getContext('2d');
              drawCtx.clearRect(0, 0, width, height);
              drawCtx.lineCap = 'round';
              drawCtx.lineJoin = 'round';

              const lineCtx = lineCanvas.getContext('2d');
              lineCtx.clearRect(0, 0, width, height);
              lineCtx.drawImage(img, 0, 0, width, height);

              const imageData = lineCtx.getImageData(0, 0, width, height);
              const data = imageData.data;

              for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const brightness = (r + g + b) / 3;

                if (brightness >= brightnessThreshold) {
                  data[i + 3] = 0;
                }
              }

              lineCtx.putImageData(imageData, 0, 0);

              setUploadedImage(event.target.result);

              setHistory([]);
              setHistoryIndex(-1);

              console.log('„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂÆå‰∫Ü');
            } catch (error) {
              console.error('„Ç≠„É£„É≥„Éê„ÇπÊèèÁîª„Ç®„É©„Éº:', error);
              alert('ÁîªÂÉè„ÅÆË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
          };

          img.src = event.target.result;
        };

        reader.readAsDataURL(file);
      };

      const startDrawing = (e) => {
        setIsDrawing(true);
        draw(e);
      };

      const stopDrawing = () => {
        if (isDrawing) {
          saveToHistory();
        }
        setIsDrawing(false);
        const ctx = drawCanvasRef.current.getContext('2d');
        ctx.beginPath();
      };

      const saveToHistory = () => {
        const canvas = drawCanvasRef.current;
        if (!canvas) return;

        const imageData = canvas.toDataURL();

        const newHistory = history.slice(0, historyIndex + 1);

        newHistory.push(imageData);

        if (newHistory.length > maxHistory) {
          newHistory.shift();
          setHistory(newHistory);
          setHistoryIndex(newHistory.length - 1);
        } else {
          setHistory(newHistory);
          setHistoryIndex(newHistory.length - 1);
        }
      };

      const undo = () => {
        if (historyIndex < 0) return;

        const canvas = drawCanvasRef.current;
        const ctx = canvas.getContext('2d');

        if (historyIndex === 0) {
          // ÊúÄÂàù„ÅÆÁä∂ÊÖã„Å´Êàª„Çã = „Ç≠„É£„É≥„Éê„Çπ„Çí„ÇØ„É™„Ç¢
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          setHistoryIndex(-1);
          return;
        }

        const img = new Image();

        img.onload = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };

        img.src = history[historyIndex - 1];
        setHistoryIndex(historyIndex - 1);
      };

      const redo = () => {
        if (historyIndex >= history.length - 1) return;

        const canvas = drawCanvasRef.current;
        const ctx = canvas.getContext('2d');
        const img = new Image();

        img.onload = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };

        img.src = history[historyIndex + 1];
        setHistoryIndex(historyIndex + 1);
      };

      const floodFill = (e) => {
        const canvas = drawCanvasRef.current;
        const imageCanvas = imageCanvasRef.current;
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();

        let clientX, clientY;
        if (e.type.startsWith('touch')) {
          e.preventDefault();
          clientX = e.touches[0].clientX;
          clientY = e.touches[0].clientY;
        } else {
          clientX = e.clientX;
          clientY = e.clientY;
        }

        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        const x = Math.floor((clientX - rect.left) * scaleX);
        const y = Math.floor((clientY - rect.top) * scaleY);

        if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height) return;

        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');

        tempCtx.drawImage(imageCanvas, 0, 0);
        tempCtx.drawImage(canvas, 0, 0);

        const imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        const targetColor = getPixelColor(data, x, y, canvas.width);
        const fillColor = hexToRgb(currentColor);

        if (colorsMatch(targetColor, fillColor)) return;

        const imgCtx = imageCanvas.getContext('2d');
        const originalData = imgCtx.getImageData(0, 0, canvas.width, canvas.height);

        // ÊèèÁîª„Ç≠„É£„É≥„Éê„Çπ„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶Áõ¥Êé•Êõ¥Êñ∞
        const drawImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const drawData = drawImageData.data;

        const stack = [[x, y]];
        const visited = new Set();
        const maxIterations = 200000;
        let iterations = 0;

        while (stack.length > 0 && iterations < maxIterations) {
          iterations++;
          const [px, py] = stack.pop();
          const key = `${px},${py}`;

          if (visited.has(key)) continue;
          if (px < 0 || px >= canvas.width || py < 0 || py >= canvas.height) continue;

          const pixelColor = getPixelColor(data, px, py, canvas.width);

          const origIndex = (py * canvas.width + px) * 4;
          const origBrightness = (originalData.data[origIndex] + originalData.data[origIndex + 1] + originalData.data[origIndex + 2]) / 3;
          if (origBrightness < brightnessThreshold) continue;

          if (!colorsMatch(pixelColor, targetColor)) continue;

          visited.add(key);

          // „Éá„Éº„ÇøÈÖçÂàó„ÇíÁõ¥Êé•Êõ¥Êñ∞
          const index = (py * canvas.width + px) * 4;
          drawData[index] = fillColor.r;
          drawData[index + 1] = fillColor.g;
          drawData[index + 2] = fillColor.b;
          drawData[index + 3] = 255;

          // ÂêàÊàê„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞ÔºàÊ¨°„ÅÆ„Éî„ÇØ„Çª„É´Âà§ÂÆöÁî®Ôºâ
          data[index] = fillColor.r;
          data[index + 1] = fillColor.g;
          data[index + 2] = fillColor.b;
          data[index + 3] = 255;

          stack.push([px + 1, py]);
          stack.push([px - 1, py]);
          stack.push([px, py + 1]);
          stack.push([px, py - 1]);
        }

        // ÊèèÁîª„Ç≠„É£„É≥„Éê„Çπ„Å´‰∏ÄÂ∫¶„Å´ÂèçÊò†
        ctx.putImageData(drawImageData, 0, 0);

        saveToHistory();
      };

      const getPixelColor = (data, x, y, width) => {
        const index = (y * width + x) * 4;
        return {
          r: data[index],
          g: data[index + 1],
          b: data[index + 2],
          a: data[index + 3]
        };
      };

      const setPixelColor = (ctx, x, y, color) => {
        ctx.fillStyle = `rgba(${color.r}, ${color.g}, ${color.b}, 1)`;
        ctx.fillRect(x, y, 1, 1);
      };

      const hexToRgb = (hex) => {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16)
        } : { r: 0, g: 0, b: 0 };
      };

      const colorsMatch = (a, b, tolerance = 50) => {
        return Math.abs(a.r - b.r) <= tolerance &&
               Math.abs(a.g - b.g) <= tolerance &&
               Math.abs(a.b - b.b) <= tolerance;
      };

      const handleCanvasClick = (e) => {
        if (tool === 'fill') {
          floodFill(e);
        }
      };

      const draw = (e) => {
        if (!isDrawing && e.type !== 'mousedown' && e.type !== 'touchstart') return;

        const canvas = drawCanvasRef.current;
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();

        let clientX, clientY;
        if (e.type.startsWith('touch')) {
          e.preventDefault();
          clientX = e.touches[0].clientX;
          clientY = e.touches[0].clientY;
        } else {
          clientX = e.clientX;
          clientY = e.clientY;
        }

        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        const x = (clientX - rect.left) * scaleX;
        const y = (clientY - rect.top) * scaleY;

        if (tool === 'eraser') {
          ctx.globalCompositeOperation = 'destination-out';
          ctx.lineWidth = brushSize * 2;
          ctx.strokeStyle = 'rgba(0,0,0,1)';
        } else {
          ctx.globalCompositeOperation = 'source-over';
          ctx.lineWidth = brushSize;
          ctx.strokeStyle = currentColor;
        }

        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      };

      const clearCanvas = () => {
        const drawCanvas = drawCanvasRef.current;
        const drawCtx = drawCanvas.getContext('2d');

        drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);

        saveToHistory();
      };

      const downloadImage = () => {
        const imageCanvas = imageCanvasRef.current;
        const drawCanvas = drawCanvasRef.current;
        const lineCanvas = lineCanvasRef.current;

        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = imageCanvas.width;
        tempCanvas.height = imageCanvas.height;
        const tempCtx = tempCanvas.getContext('2d');

        tempCtx.drawImage(imageCanvas, 0, 0);
        tempCtx.drawImage(drawCanvas, 0, 0);
        tempCtx.drawImage(lineCanvas, 0, 0);

        const link = document.createElement('a');
        link.download = 'my-coloring.png';
        link.href = tempCanvas.toDataURL();
        link.click();
      };

      return (
        <div style={{
          minHeight: '100vh',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          padding: '2rem',
          fontFamily: '"Fredoka", "Comic Neue", cursive'
        }}>
          <style>{`
            @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');

            @keyframes float {
              0%, 100% { transform: translateY(0px); }
              50% { transform: translateY(-10px); }
            }

            @keyframes pulse {
              0%, 100% { transform: scale(1); }
              50% { transform: scale(1.05); }
            }

            .tool-btn {
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .tool-btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            }

            .tool-btn:active {
              transform: scale(0.95);
            }

            .color-swatch {
              transition: all 0.2s ease;
            }

            .color-swatch:hover {
              transform: scale(1.15);
            }
          `}</style>

          <div style={{
            maxWidth: '1200px',
            margin: '0 auto'
          }}>
            <div style={{
              textAlign: 'center',
              marginBottom: '2rem',
              animation: 'float 3s ease-in-out infinite'
            }}>
              <h1 style={{
                fontSize: '3rem',
                fontWeight: '700',
                color: '#fff',
                margin: '0',
                textShadow: '4px 4px 0px rgba(0,0,0,0.2)',
                letterSpacing: '2px'
              }}>
                üé® „Å¨„Çä„Åà„Çπ„Çø„Ç∏„Ç™
              </h1>
              <div style={{
                display: 'inline-block',
                marginTop: '0.5rem',
                padding: '0.25rem 0.75rem',
                background: 'rgba(255,255,255,0.2)',
                borderRadius: '12px',
                fontSize: '0.9rem',
                fontWeight: '600',
                color: '#fff',
                backdropFilter: 'blur(10px)'
              }}>
                v1.0.3
              </div>
              <p style={{
                color: 'rgba(255,255,255,0.9)',
                fontSize: '1.1rem',
                marginTop: '0.5rem'
              }}>
                ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„ÄÅËá™Áî±„Å´Ëâ≤„ÇíÂ°ó„Çç„ÅÜÔºÅ
              </p>
            </div>

            <div style={{
              background: 'rgba(255,255,255,0.95)',
              borderRadius: '24px',
              padding: '2rem',
              boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
            }}>
              {!uploadedImage && (
                <div style={{
                  textAlign: 'center',
                  padding: '4rem 2rem'
                }}>
                  <label style={{
                    display: 'inline-block',
                    padding: '1.5rem 3rem',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    color: '#fff',
                    borderRadius: '16px',
                    fontSize: '1.2rem',
                    fontWeight: '600',
                    cursor: 'pointer',
                    boxShadow: '0 8px 24px rgba(102,126,234,0.4)',
                    animation: 'pulse 2s ease-in-out infinite'
                  }}>
                    <Upload size={24} style={{ marginRight: '0.5rem', verticalAlign: 'middle' }} />
                    ÁîªÂÉè„ÇíÈÅ∏Êäû
                    <input
                      type="file"
                      accept="image/*"
                      onChange={handleImageUpload}
                      onClick={(e) => e.target.value = null}
                      style={{ display: 'none' }}
                    />
                  </label>
                  <p style={{
                    marginTop: '1.5rem',
                    color: '#666',
                    fontSize: '1rem'
                  }}>
                    Á∑öÁîª„ÇÑ„Å¨„Çä„ÅàÁî®„ÅÆÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                  </p>
                </div>
              )}

              <div style={{
                display: 'grid',
                gridTemplateColumns: uploadedImage ? '200px 1fr' : '1fr',
                gap: '2rem'
              }}>
                {uploadedImage && (
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '1.5rem'
                  }}>
                    <div style={{
                      background: '#f8f9fa',
                      borderRadius: '16px',
                      padding: '1rem'
                    }}>
                      <h3 style={{
                        fontSize: '0.9rem',
                        fontWeight: '600',
                        color: '#333',
                        marginBottom: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '0.5rem'
                      }}>
                        <Palette size={18} />
                        „Ç´„É©„Éº„Éë„É¨„ÉÉ„Éà
                      </h3>
                      <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(4, 1fr)',
                        gap: '0.5rem'
                      }}>
                        {colors.map((color) => (
                          <button
                            key={color}
                            className="color-swatch"
                            onClick={() => {
                              setCurrentColor(color);
                            }}
                            style={{
                              width: '36px',
                              height: '36px',
                              borderRadius: '8px',
                              border: currentColor === color ? '3px solid #667eea' : '2px solid #ddd',
                              background: color,
                              cursor: 'pointer',
                              boxShadow: currentColor === color ? '0 4px 12px rgba(102,126,234,0.4)' : 'none'
                            }}
                          />
                        ))}
                      </div>
                      <div style={{
                        marginTop: '1rem',
                        paddingTop: '1rem',
                        borderTop: '1px solid #ddd'
                      }}>
                        <label style={{
                          display: 'flex',
                          alignItems: 'center',
                          gap: '0.5rem',
                          cursor: 'pointer'
                        }}>
                          <span style={{
                            fontSize: '0.85rem',
                            fontWeight: '600',
                            color: '#555'
                          }}>
                            „Ç´„Çπ„Çø„É†:
                          </span>
                          <input
                            type="color"
                            value={currentColor}
                            onChange={(e) => setCurrentColor(e.target.value)}
                            style={{
                              width: '60px',
                              height: '36px',
                              border: '2px solid #667eea',
                              borderRadius: '8px',
                              cursor: 'pointer'
                            }}
                          />
                          <span style={{
                            fontSize: '0.75rem',
                            color: '#888',
                            fontFamily: 'monospace'
                          }}>
                            {currentColor}
                          </span>
                        </label>
                      </div>
                    </div>

                    <div style={{
                      background: '#f8f9fa',
                      borderRadius: '16px',
                      padding: '1rem'
                    }}>
                      <h3 style={{
                        fontSize: '0.9rem',
                        fontWeight: '600',
                        color: '#333',
                        marginBottom: '1rem'
                      }}>
                        „Éñ„É©„Ç∑„Çµ„Ç§„Ç∫
                      </h3>
                      <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '0.5rem',
                        marginBottom: '0.5rem'
                      }}>
                        <button
                          className="tool-btn"
                          onClick={() => setBrushSize(Math.max(2, brushSize - 2))}
                          style={{
                            padding: '0.5rem',
                            background: '#fff',
                            border: '2px solid #ddd',
                            borderRadius: '8px',
                            cursor: 'pointer'
                          }}
                        >
                          <Minus size={16} />
                        </button>
                        <div style={{
                          flex: 1,
                          textAlign: 'center',
                          fontSize: '1.1rem',
                          fontWeight: '600',
                          color: '#667eea'
                        }}>
                          {brushSize}px
                        </div>
                        <button
                          className="tool-btn"
                          onClick={() => setBrushSize(Math.min(50, brushSize + 2))}
                          style={{
                            padding: '0.5rem',
                            background: '#fff',
                            border: '2px solid #ddd',
                            borderRadius: '8px',
                            cursor: 'pointer'
                          }}
                        >
                          <Plus size={16} />
                        </button>
                      </div>
                      <input
                        type="range"
                        min="2"
                        max="50"
                        value={brushSize}
                        onChange={(e) => setBrushSize(Number(e.target.value))}
                        style={{
                          width: '100%',
                          cursor: 'pointer'
                        }}
                      />
                    </div>

                    <div style={{
                      background: '#f8f9fa',
                      borderRadius: '16px',
                      padding: '1rem'
                    }}>
                      <h3 style={{
                        fontSize: '0.9rem',
                        fontWeight: '600',
                        color: '#333',
                        marginBottom: '1rem'
                      }}>
                        „ÉÑ„Éº„É´
                      </h3>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                        <button
                          className="tool-btn"
                          onClick={() => setTool('brush')}
                          style={{
                            padding: '0.75rem',
                            background: tool === 'brush' ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#fff',
                            color: tool === 'brush' ? '#fff' : '#333',
                            border: '2px solid ' + (tool === 'brush' ? '#667eea' : '#ddd'),
                            borderRadius: '12px',
                            cursor: 'pointer',
                            fontWeight: '600',
                            fontSize: '0.9rem',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            justifyContent: 'center'
                          }}
                        >
                          <Palette size={18} />
                          „Éñ„É©„Ç∑
                        </button>
                        <button
                          className="tool-btn"
                          onClick={() => setTool('fill')}
                          style={{
                            padding: '0.75rem',
                            background: tool === 'fill' ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#fff',
                            color: tool === 'fill' ? '#fff' : '#333',
                            border: '2px solid ' + (tool === 'fill' ? '#667eea' : '#ddd'),
                            borderRadius: '12px',
                            cursor: 'pointer',
                            fontWeight: '600',
                            fontSize: '0.9rem',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            justifyContent: 'center'
                          }}
                        >
                          <PaintBucket size={18} />
                          Â°ó„Çä„Å§„Å∂„Åó
                        </button>
                        <button
                          className="tool-btn"
                          onClick={() => setTool('eraser')}
                          style={{
                            padding: '0.75rem',
                            background: tool === 'eraser' ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#fff',
                            color: tool === 'eraser' ? '#fff' : '#333',
                            border: '2px solid ' + (tool === 'eraser' ? '#667eea' : '#ddd'),
                            borderRadius: '12px',
                            cursor: 'pointer',
                            fontWeight: '600',
                            fontSize: '0.9rem',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            justifyContent: 'center'
                          }}
                        >
                          <Eraser size={18} />
                          Ê∂à„Åó„Ç¥„É†
                        </button>
                      </div>
                    </div>

                    <div style={{
                      background: '#f8f9fa',
                      borderRadius: '16px',
                      padding: '1rem'
                    }}>
                      <h3 style={{
                        fontSize: '0.9rem',
                        fontWeight: '600',
                        color: '#333',
                        marginBottom: '1rem'
                      }}>
                        „Ç¢„ÇØ„Ç∑„Éß„É≥
                      </h3>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                        <div style={{ display: 'flex', gap: '0.5rem' }}>
                          <button
                            className="tool-btn"
                            onClick={undo}
                            disabled={historyIndex < 0}
                            style={{
                              flex: 1,
                              padding: '0.75rem',
                              background: '#fff',
                              color: historyIndex < 0 ? '#ccc' : '#333',
                              border: '2px solid #ddd',
                              borderRadius: '12px',
                              cursor: historyIndex < 0 ? 'not-allowed' : 'pointer',
                              fontWeight: '600',
                              fontSize: '0.9rem',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '0.5rem',
                              justifyContent: 'center',
                              opacity: historyIndex < 0 ? 0.5 : 1
                            }}
                          >
                            <Undo2 size={18} />
                            Êàª„Åô
                          </button>
                          <button
                            className="tool-btn"
                            onClick={redo}
                            disabled={historyIndex >= history.length - 1}
                            style={{
                              flex: 1,
                              padding: '0.75rem',
                              background: '#fff',
                              color: historyIndex >= history.length - 1 ? '#ccc' : '#333',
                              border: '2px solid #ddd',
                              borderRadius: '12px',
                              cursor: historyIndex >= history.length - 1 ? 'not-allowed' : 'pointer',
                              fontWeight: '600',
                              fontSize: '0.9rem',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '0.5rem',
                              justifyContent: 'center',
                              opacity: historyIndex >= history.length - 1 ? 0.5 : 1
                            }}
                          >
                            <Redo2 size={18} />
                            ÈÄ≤„ÇÄ
                          </button>
                        </div>

                        <label style={{
                          padding: '0.75rem',
                          background: '#fff',
                          color: '#333',
                          border: '2px solid #ddd',
                          borderRadius: '12px',
                          cursor: 'pointer',
                          fontWeight: '600',
                          fontSize: '0.9rem',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '0.5rem',
                          justifyContent: 'center',
                          transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)'
                        }}
                        className="tool-btn">
                          <Upload size={18} />
                          Âà•„ÅÆÁîªÂÉè
                          <input
                            type="file"
                            accept="image/*"
                            onChange={handleImageUpload}
                            onClick={(e) => e.target.value = null}
                            style={{ display: 'none' }}
                          />
                        </label>
                        <button
                          className="tool-btn"
                          onClick={clearCanvas}
                          style={{
                            padding: '0.75rem',
                            background: '#fff',
                            color: '#333',
                            border: '2px solid #ddd',
                            borderRadius: '12px',
                            cursor: 'pointer',
                            fontWeight: '600',
                            fontSize: '0.9rem',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            justifyContent: 'center'
                          }}
                        >
                          <RotateCcw size={18} />
                          „É™„Çª„ÉÉ„Éà
                        </button>
                        <button
                          className="tool-btn"
                          onClick={downloadImage}
                          style={{
                            padding: '0.75rem',
                            background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                            color: '#fff',
                            border: 'none',
                            borderRadius: '12px',
                            cursor: 'pointer',
                            fontWeight: '600',
                            fontSize: '0.9rem',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            justifyContent: 'center'
                          }}
                        >
                          <Download size={18} />
                          ‰øùÂ≠ò
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                <div style={{
                  background: '#fff',
                  borderRadius: '16px',
                  padding: '1rem',
                  boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
                  display: 'flex',
                  justifyContent: 'center',
                  alignItems: 'center',
                  minHeight: '400px'
                }}>
                  <div style={{ position: 'relative', display: 'inline-block' }}>
                    <canvas
                      ref={imageCanvasRef}
                      style={{
                        border: '3px solid #e9ecef',
                        borderRadius: '12px',
                        maxWidth: '100%',
                        height: 'auto',
                        display: 'block',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                      }}
                    />
                    <canvas
                      ref={drawCanvasRef}
                      onMouseDown={(e) => {
                        if (tool === 'fill') {
                          handleCanvasClick(e);
                        } else {
                          startDrawing(e);
                        }
                      }}
                      onMouseMove={draw}
                      onMouseUp={stopDrawing}
                      onMouseLeave={stopDrawing}
                      onTouchStart={(e) => {
                        e.preventDefault();
                        if (tool === 'fill') {
                          handleCanvasClick(e);
                        } else {
                          startDrawing(e);
                        }
                      }}
                      onTouchMove={(e) => {
                        e.preventDefault();
                        if (tool !== 'fill') {
                          draw(e);
                        }
                      }}
                      onTouchEnd={stopDrawing}
                      style={{
                        position: 'absolute',
                        top: '0',
                        left: '0',
                        cursor: tool === 'fill' ? 'pointer' : (tool === 'brush' ? 'crosshair' : 'pointer'),
                        maxWidth: '100%',
                        height: 'auto',
                        touchAction: 'none',
                        pointerEvents: 'auto'
                      }}
                    />
                    <canvas
                      ref={lineCanvasRef}
                      style={{
                        position: 'absolute',
                        top: '0',
                        left: '0',
                        maxWidth: '100%',
                        height: 'auto',
                        pointerEvents: 'none'
                      }}
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ColoringApp />);
  </script>
</body>
</html>
